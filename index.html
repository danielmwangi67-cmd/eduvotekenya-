<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EduVote Kenya | Student Code Generator</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    height: 100%;
    background: linear-gradient(135deg, #1e3c72, #2a5298, #ffd700);
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    color: #fff;
  }

  /* Moving stars effect using CSS */
  .stars {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    box-shadow: 
      50vw 30vh white,
      20vw 80vh white,
      70vw 60vh white,
      90vw 10vh white,
      30vw 50vh white,
      60vw 90vh white;
    animation: twinkle 2s infinite alternate;
  }

  @keyframes twinkle {
    from { opacity: 0.2; transform: scale(1); }
    to { opacity: 1; transform: scale(1.3); }
  }

  .box {
    position: relative;
    z-index: 10;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 0 25px rgba(0,0,0,0.3);
    background: rgba(0,0,0,0.7);
    text-align: center;
    max-width: 450px;
  }

  h2 {
    font-size: 28px;
    background: linear-gradient(90deg, #ff0055, #ffcc00, #00ccff, #ff00ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: colorflow 5s linear infinite;
  }
  @keyframes colorflow {
    0% { background-position:0% 50%; } 
    100% { background-position:100% 50%; }
  }

  p { color:#ffd700; font-weight:500; }
  input {
    padding:12px;
    border-radius:10px;
    border:none;
    width:250px;
    text-align:center;
    margin-top:10px;
    font-size:16px;
  }
  button {
    display:block;
    margin:20px auto 0;
    padding:12px 25px;
    border:none;
    border-radius:10px;
    font-weight:bold;
    font-size:16px;
    background:#ffd700;
    color:#0d1b2a;
    cursor:pointer;
    transition:0.3s;
  }
  button:hover {
    background:#003366;
    color:#ffd700;
    transform:scale(1.05);
    box-shadow:0 0 15px rgba(0,0,0,0.4);
  }

  #message { margin-top:20px; font-weight:bold; transition:opacity 1s ease; }
</style>
</head>
<body>

<div class="stars"></div>

<div class="box">
  <h2>EduVote Kenya – Student Code Generator</h2>
  <p>Enter your School Code below</p>
  <input type="text" id="code" placeholder="Enter School Code" />
  <button onclick="generateCodes()">Generate Student Codes</button>
  <div id="message"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxLaV4Qu6px9bKpmcIK763loSST9SVgxrB_Aq1zvrXinkxdnYdhVg9K5AMHI5YJ9g1X/exec"; // Apps Script URL
const landingPage = "https://www.eduvotekenya.co.ke/home";

async function generateCodes() {
  const code = document.getElementById("code").value.trim();
  const msg = document.getElementById("message");

  if(!code){
    msg.textContent="Please enter your school code.";
    msg.style.color="orange";
    fadeMessage(msg);
    return;
  }

  msg.textContent="Processing...";
  msg.style.color="#00ffcc";

  try {
    const res = await fetch(`${scriptURL}?action=generateStudentCodes&code=${encodeURIComponent(code)}`);
    const text = await res.text();

    if(text.includes("❌")){
      msg.textContent=text;
      msg.style.color="red";
      fadeMessage(msg);
    } else {
      msg.textContent="✅ Student codes generated! Downloading CSV...";
      msg.style.color="#00ff88";
      launchConfetti();

      const blob = new Blob([text], {type:"text/csv"});
      const url = URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url;
      a.download="StudentCodes.csv";
      a.click();
      URL.revokeObjectURL(url);

      setTimeout(()=>{ window.location.href=landingPage; },3000);
    }
  } catch(err){
    msg.textContent="⚠️ Error connecting to server. Make sure Apps Script is deployed.";
    msg.style.color="orange";
    fadeMessage(msg);
    console.error(err);
  }
}

function fadeMessage(el){ el.style.opacity=1; setTimeout(()=>{ el.style.opacity=0; },3000);}
function launchConfetti(){ 
  const end = Date.now()+2000; 
  (function frame(){ 
    const colors=['#ffd700','#ff00ff','#00ff88','#00ccff','#ff5500']; 
    confetti({particleCount:6, angle:60, spread:60, origin:{x:0}, colors:colors}); 
    confetti({particleCount:6, angle:120, spread:60, origin:{x:1}, colors:colors}); 
    if(Date.now()<end) requestAnimationFrame(frame); 
  })(); 
}
</script>
</body>
</html>






